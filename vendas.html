<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>VendasÂ â€‘Â AdegaÂ Lounge</title>
  <link rel="stylesheet" href="./css/style.css" />

  <!-- estilos sÃ³ do modal/itens -->
  <style>
    #modal-fiado{display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.5);justify-content:center;align-items:center}
    #modal-fiado .modal-content{background:#fff;padding:1rem 2rem;border-radius:8px;max-width:420px;width:90%}
    .item-linha{display:flex;justify-content:space-between;border-bottom:1px solid #ddd;padding:.3rem 0}
    .remover-item-btn{background:#d9534f;color:#fff;border:none;border-radius:4px;padding:0 .5rem;cursor:pointer}
    .remover-item-btn:hover{background:#c9302c}
    #itens-container{margin-top:1rem;border:1px solid #ccc;background:#fafafa;padding:.5rem;max-height:180px;overflow-y:auto}
    #fiado-itens-lista{margin-top:1rem;border:1px solid #ddd;padding:.5rem;max-height:120px;overflow-y:auto}

    /* Estilo para o botÃ£o Voltar amarelo padrÃ£o */
    #btn-voltar {
      background-color: #ffcc00; /* amarelo padrÃ£o */
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      color: #333;
      margin-bottom: 1rem;
      transition: background-color 0.3s ease;
    }
    #btn-voltar:hover {
      background-color: #e6b800; /* amarelo um pouco mais escuro */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>VendasÂ â€‘Â AdegaÂ Lounge</h1>

    <!-- menu construÃ­do no JS (admin vs funcionÃ¡rio) -->
    <nav id="nav-menu"></nav>

    <button id="btn-voltar">ðŸ”™Â Voltar</button>

    <div id="form-venda">
      <h2>RegistrarÂ Venda</h2>

      <!-- NOVO: novalidate + sem required  -->
      <form id="form-registro-venda" novalidate>
        <label>Produto:
          <select id="produto-select">
            <option value="">Selecione um produto</option>
          </select>
        </label>

        <label>Quantidade:
          <input type="number" id="quantidade-venda" min="1" step="1">
        </label>

        <button type="button" id="add-item-btn">AdicionarÂ Item</button>

        <div id="itens-container"></div>

        <p><strong>Total:</strong>Â <span id="valor-total">R$Â 0,00</span></p>

        <button type="button" id="btn-pagar-pix">PagarÂ comÂ PIX</button>
        <button type="submit">ConcluirÂ Venda</button>
      </form>

      <button id="btn-fiado" type="button">RegistrarÂ VendaÂ noÂ FiadoÂ (CrÃ©dito)</button>
    </div>

    <h3>Vendas realizadas (hoje)</h3>
    <div class="tabela-responsiva">
      <table id="tabela-vendas-dia">
        <thead>
          <tr><th>Produto</th><th>Qtd</th><th>SubtotalÂ (R$)</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h3>Total do dia:Â <span id="total-dia">R$Â 0,00</span></h3>
    <button id="finalizar-expediente" type="button">FinalizarÂ Expediente</button>
  </div>

  <!-- ============ Modal Fiado ============ -->
  <div id="modal-fiado">
    <div class="modal-content">
      <h2>VendaÂ noÂ Fiado</h2>

     <label>Cliente:
  <select id="fiado-cliente-select">
    <option value="">Selecione o cliente</option>
  </select>
</label>


      <label>Produto:
        <select id="fiado-produto"><option value="">Selecione o produto</option></select>
      </label>

      <label>Quantidade:
        <input type="number" id="fiado-quantidade" min="1" step="1">
      </label>

      <button type="button" id="fiado-add-item-btn">âž•Â Adicionar</button>

      <ul id="fiado-itens-lista"></ul>

      <p><strong>Subtotal:</strong>Â <span id="fiado-subtotal">R$Â 0,00</span></p>

      <button id="btn-salvar-fiado"   type="button">SalvarÂ CrÃ©dito</button>
      <button id="btn-cancelar-fiado" type="button">Cancelar</button>
    </div>
  </div>

  <!-- ============ Modal PIX ============ -->
  <div id="modal-pix" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:10000;justify-content:center;align-items:center;flex-direction:column;">
    <div style="background:#fff;padding:1.5rem;border-radius:8px;max-width:320px;width:90%;text-align:center">
      <h2>PagamentoÂ viaÂ PIX</h2>
      <canvas id="pix-qrcode" style="margin:1rem auto;"></canvas>
      <p>Escaneie o QRÂ Code acima para pagar.</p>
      <button id="btn-fechar-pix" style="margin-top:.5rem;padding:.4rem .9rem">Fechar</button>
    </div>
  </div>

  <!-- QRCode lib -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <!-- Firebase nav dinÃ¢mico (mÃ­nimo) -->
  <script type="module">
    import { auth, db } from './js/firebaseConfig.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    onAuthStateChanged(auth, async user=>{
      if(!user){ location.href='login.html'; return; }

      const snap = await getDoc(doc(db,'usuarios',user.uid));
      const tipo = snap.exists()? snap.data().tipo : 'funcionario';

      const nav = document.getElementById('nav-menu');
      nav.innerHTML = (tipo==='admin')
        ? `<a href="estoque.html">Estoque</a>
           <a href="creditos.html">CrÃ©ditos</a>
           <a href="historico.html">HistÃ³rico</a>
           <a href="admin.html">AdministraÃ§Ã£o</a>
           <a href="login.html" id="btn-logout">Sair</a>`
        : `<a href="estoque.html">Estoque</a>
           <a href="login.html" id="btn-logout">Sair</a>`;
    });

    // BotÃ£o Voltar - mantÃ©m comportamento original e adiciona fallback
    document.addEventListener('DOMContentLoaded', () => {
      const btnVoltar = document.getElementById('btn-voltar');
      btnVoltar.addEventListener('click', () => {
        if (history.length > 1) {
          history.back();
        } else {
          window.location.href = 'index.html';
        }
      });
    });
  </script>

  <!-- lÃ³gica principal -->
  <script type="module" src="js/vendas.js"></script>
  <script type="module" src="js/logout.js"></script>

  <!-- Banner instalaÃ§Ã£o iOS -->
  <div id="install-banner" style="display:none;background:#fff3cd;padding:1rem;border:1px solid #ffeeba;text-align:center;position:fixed;bottom:1rem;left:1rem;right:1rem;z-index:1000;">
    ðŸ“²Â Para instalar o app, toque em <strong>Compartilhar</strong>Â â†’Â <strong>â€˜AdicionarÂ Ã â€¯Telaâ€™</strong>.
    <button onclick="this.parentElement.remove()" style="margin-left:1rem;background:none;border:none;font-size:1.25rem">Ã—</button>
  </div>
  <script>
    const isIOS=/iphone|ipad|ipod/i.test(navigator.userAgent);
    if(isIOS&&!window.matchMedia('(display-mode: standalone)').matches)
      document.getElementById('install-banner').style.display='block';
  </script>
</body>
</html>
